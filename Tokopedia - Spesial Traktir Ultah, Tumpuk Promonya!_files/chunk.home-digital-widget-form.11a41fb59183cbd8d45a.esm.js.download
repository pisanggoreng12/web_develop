(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[344],{1418:function(e,t){e.exports="https://assets.tokopedia.net/assets-tokopedia-lite/v2/zeus/kratos/376c1f91.svg"},1833:function(e,t,a){"use strict";var l=a(0);t.a=function(e){var t=Object(l.useRef)();return Object(l.useEffect)((function(){t.current=e}),[e]),t.current}},3678:function(e,t,a){"use strict";a.r(t);var l=a(0),o=a.n(l),n=a(114),r=a.n(n),i=a(1833),s=a(22),c=a(2549),d=a(9),u=a(2439),p=a(66),m=a(354),b=a(123),f=a(177),v=a.n(f),h=a(1089),g=a(105),O=a.n(g),y=a(339),N=a.n(y),j=a(249),x=a.n(j),k=a(191),E=a.n(k),P=a(371),w=a.n(P);async function I(e){const t=await async function(){const e=w()().importKey?(await a.e(830).then(a.t.bind(null,1045,7))).default:void 0;return await N()(d.s,["encrypt"],{importPublicKeyPolyfill:e})}(),l=await async function(e,t,l){const o=E()(l),n=o.textEncoder?(await a.e(702).then(a.t.bind(null,694,7))).default:void 0,r=o.digest?(await Promise.all([a.e(80),a.e(635)]).then(a.t.bind(null,695,7))).default:void 0,i=o.encrypt?(await Promise.all([a.e(80),a.e(817)]).then(a.t.bind(null,1046,7))).default:void 0;return await x()(e,t,l,{name:"RSA-OAEP"},{encryptPolyfill:i,textEncoderPolyfill:n,digestPolyfill:r,ciphertextFormat:"base64"})}(e,t,"open");return l}const C=e=>0===Object.keys(e).filter((t=>{const a=e[t];return!Object(h.c)(a)&&v()(a)})).length,D=e=>{const t=Object.keys(e);return t.filter((t=>{const a=e[t];return!Object(h.c)(a)&&v()(a)})).length===t.length},_=e=>{const t=0===e.keyCode?e.charCode:e.keyCode,a=Number(e.target.value+e.key)||0;return t>=37&&t<=40||8===t||9===t||13===t||t>=48&&t<=57?/^\\d+$/.test(a):e.preventDefault()};var S=a(2763),V=a(2),T=a(56),z=a(150),R=a(621),A=a(48);const B=Object(V.css)("max-width:50px;height:20px;"),L=({alt:e,imageUrl:t})=>t?o.a.createElement("img",{className:B,alt:e,src:t}):null;L.defaultProps={alt:"",imageUrl:""};var M=Object(l.memo)(L),U=a(16),$=a(231);const H=Object(V.css)("cursor:pointer;max-width:200px;position:absolute;z-index:1;top:100%;font-size:11px;line-height:16px;color:",U.R600,";background-color:",U.N0,";box-shadow:",$.i," 0px 1px 6px 0px;padding:12px 16px;border-radius:4px;word-break:break-word;&::after{transform:translate(-10%,-100%);border-color:transparent transparent ",U.N0,";}&::before{transform:translate(-10%,-100%);border-color:transparent transparent ",$.d,";}&::before,&::after{content:'';display:block;position:absolute;top:0;left:10%;border-width:6px;border-style:solid;}"),K=e=>{const{children:t,onClose:a}=e;return Object(l.useEffect)((()=>{const e=()=>a&&a();return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}}),[a]),t?o.a.createElement("div",{className:H},t):null};K.defaultProps={children:null,onClose:void 0};var q=K;const F=[1,2];var G=()=>{const[e,{data:t,error:a,loading:o}]=Object(s.useLazyQuery)(c.e,{variables:{input:{channelName:"favorite_number_prefill",dgCategoryIDs:F}}});return{prefillCustomerNumber:Object(l.useMemo)((()=>{return!o&&a?"":!o&&t&&(null===(e=t.digiPersoGetPersonalizedItems.items[0])||void 0===e?void 0:e.title)||"";var e}),[t,a,o]),fetchPrefillData:e}};const J="@event/INIT_FORM",Q="@event/ON_FIELD_CHANGE",W="@event/ON_FIELD_ERROR",X="@event/RESET_ERROR",Y="@event/RESET_FORM",Z=J,ee=Q,te=W,ae=X,le=Y,oe={fields:{clientNumber:"",prodId:"",prodValue:"",prodPrice:""},errors:{},isEmpty:!0,isValid:!1},ne={fields:{clientNumber:"",opId:"",opValue:"",prodId:"",prodValue:"",prodPrice:""},errors:{},isEmpty:!0,isValid:!1},re=(e,t)=>{switch(t.type){case J:if((a=t.initial)&&Object(h.d)(a)&&!v()(a)){const a={...e.fields,...t.initial};return{...e,fields:a,isEmpty:D(a),isValid:C(a)}}return e;case Q:{const{changes:a}=t,l={...e.fields},o=a.reduce(((e,t)=>{const a=t[0],l=t[1];return a&&(e[a]=l||""),e}),l);return{...e,fields:o,errors:{},isEmpty:D(o),isValid:C(o)}}case W:{const a={...e.errors},l=t.errors.reduce(((e,t)=>{const a=t[0],l=t[1];return e[a]=l||"",e}),a);return{...e,errors:l}}case X:return{...e,errors:{}};case Y:{const{state:e}=t;return e}default:return e}var a};var ie={en:{clientNumber:"Phone Number",nominal:"Nominal",selectPlaceholder:"Pick",buyBtn:"Buy",outOfStock:"Out Of Stock",textfieldPlaceholder:"Input the Number"},id:{clientNumber:"Nomor Telepon",nominal:"Nominal",selectPlaceholder:"Pilih",buyBtn:"Beli",outOfStock:"Stock Habis",textfieldPlaceholder:"Masukan Nomor"}},se=a(1418),ce=a.n(se),de=a(1);const ue=Object(V.keyframes)("from{transform:rotate(0deg);}to{transform:rotate(360deg);}"),pe=Object(V.css)("position:relative;display:flex;flex:1 1 auto;flex-flow:row;padding:6px;min-width:0px;"),me=Object(V.css)("position:relative;display:flex;flex-flow:column;flex:1 1 0;justify-content:center;padding:6px;min-width:0px;&.cta{flex:0 0 auto;min-width:none;}&.select{& > div > div{min-width:200px;}}"),be=Object(V.css)("font-size:12px;font-weight:700;line-height:18px;display:inline-block;pointer-events:none;color:",$.h,";margin-bottom:4px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;"),fe=Object(V.css)("margin:0;& > div > div > div:last-child{padding-right:8px !important;}& input{font-size:11px;padding:8px !important;}& input::-webkit-input-placeholder{color:",de.NN300,";font-size:11px;}& input:-moz-placeholder{color:",de.NN300,";font-size:11px;}& input::-moz-placeholder{color:",de.NN300,";font-size:11px;}& input:-ms-input-placeholder{color:",de.NN300,";font-size:11px;}& input::-ms-input-placeholder{color:",de.NN300,";font-size:11px;}& input::placeholder{color:",de.NN300,";font-size:11px;}"),ve=Object(V.css)("padding:0 4px 0 8px;& label{font-size:11px;}&.loading::after{animation:",ue," 1s infinite linear;background-image:url(",ce.a,");background-size:contain;}"),he=Object(V.css)("&.disabled{cursor:not-allowed;pointer-events:none;opacity:0.6;}& > button{font-size:11px;}&.disabled > button{color:",$.d,";}"),ge=Object(V.css)("top:10px;width:100%;min-width:80px;"),Oe=e=>{const{loading:t,menuID:a,operator:{id:n,imageUrl:r},products:s,validations:c,onOperatorChange:d,onSubmit:u}=e,p=Object(i.a)({menuID:a,operatorID:n}),{lang:m}=Object(l.useContext)(T.a),b=ie[m],[f,v]=Object(l.useReducer)(re,oe),{fields:h,fields:{clientNumber:g,prodValue:O},errors:y,isValid:N}=f,{prefillCustomerNumber:j,fetchPrefillData:x}=G();Object(l.useEffect)((()=>{p?p&&p.menuID!==a?v({type:le,state:oe}):p&&p.operatorID!==n&&v({type:ee,changes:[["prodId",""],["prodValue",""],["prodPrice",""]]}):v({type:Z})}),[p,a,n]),Object(l.useEffect)((()=>{d(h)}),[h,d]);const k=Object(l.useCallback)((e=>{var t,a;const l=(null==e||null===(t=e.target)||void 0===t?void 0:t.value)||"",o=l?l.toString():"",n=(null==e||null===(a=e.target)||void 0===a?void 0:a.name)||"";v({type:ee,changes:[[n,o]]})}),[]),E=Object(l.useCallback)((e=>_(e)),[]),P=Object(l.useCallback)(((e,t)=>{v({type:ee,changes:[["prodId",e.id],["prodValue",t],["prodPrice",e.price]]})}),[]),w=Object(l.useCallback)((()=>{u(h,c,(e=>{v({type:te,errors:e})}))}),[h,c,u]),I=Object(l.useCallback)((()=>{v({type:ae})}),[]),C=Object(l.useMemo)((()=>{let e=!0,t=[];return 0!==s.length?(e=!1,t=s.map((e=>{const t=3===e.status,a=`${e.desc} - ${e.value}${t?`- ${b.outOfStock}`:""}`;return{key:e.id,value:a,onClick:()=>P(e,a),props:{className:Object(V.cx)(he,{disabled:t}),"data-testid":e.value}}}))):(e=!0,t.push({key:1,value:"",props:{className:he}})),{disabled:e,items:t}}),[b,P,s]);return Object(l.useEffect)((()=>{x(),j&&v({type:ee,changes:[["clientNumber",j]]})}),[x,j]),o.a.createElement("div",{className:pe},o.a.createElement("div",{className:me},o.a.createElement("label",{className:be,title:b.clientNumber},b.clientNumber),o.a.createElement(z.a,{placeholder:b.textfieldPlaceholder,className:fe,appendObject:o.a.createElement(M,{alt:"operator_image",imageUrl:r}),name:"clientNumber",type:"number",min:"0",max:"9",value:g,onChange:k,onKeyPress:E}),Boolean(y.clientNumber)&&o.a.createElement(q,{onClose:I},(null==y?void 0:y.clientNumber)||"")),o.a.createElement("div",{className:Object(V.cx)(me,"select")},o.a.createElement("label",{className:be,title:b.nominal},b.nominal),o.a.createElement(R.default,Object.assign({placeholder:b.selectPlaceholder,value:O},C,{props:{className:Object(V.cx)(ve,{loading:t})}}))),o.a.createElement("div",{className:Object(V.cx)(me,"cta")},o.a.createElement(A.default,{main:!0,filled:!0,className:ge,disabled:!N,onClick:w},b.buyBtn)))};Oe.defaultProps={loading:!1,operator:{id:"",imageUrl:""},products:[],validations:[]};var ye=Oe,Ne=a(172),je=a.n(Ne);var xe={en:{productType:"Bill Type",productTypePlaceholder:"Choose Bill Type",clientNumber:"Subscription Number",nominal:"Nominal",nominalPlaceholder:"Pick",buyBtn:"Pay",notAvailable:"Not Available",textfieldPlaceholder:"Input the Number"},id:{productType:"Jenis Produk Listrik",productTypePlaceholder:"Pilih Jenis Produk Listrik",clientNumber:"No. Meter/ID Pel",nominal:"Nominal",nominalPlaceholder:"Pilih",buyBtn:"Bayar",notAvailable:"Tidak Tersedia",textfieldPlaceholder:"Masukan Nomor"}};const ke=(e,t)=>{if(!Object(h.d)(e)||!Object(h.d)(t))return"";const a=!(!e.status||!Object(h.c)(e.status))&&3===e.status;return`${e.desc}${a?`- ${(null==t?void 0:t.notAvailable)||""}`:""}`},Ee=e=>{const{loading:t,menuID:a,operator:{id:n},operators:r,validations:s,products:c,isShowingProduct:d,onOperatorChange:u,onSubmit:p}=e,m=Object(i.a)({menuID:a,operatorID:n}),b=Object(i.a)(c),{lang:f}=Object(l.useContext)(T.a),v=xe[f],[h,g]=Object(l.useReducer)(re,ne),{fields:O,fields:{clientNumber:y,opValue:N,prodValue:j},errors:x,isValid:k}=h;Object(l.useEffect)((()=>{if(m)m&&m.menuID!==a?g({type:le,state:ne}):m&&m.operatorID!==n&&g({type:ee,changes:[["prodId",""],["prodValue",""],["prodPrice",""]]});else{const e={opId:je()(r,"0.key")||"",opValue:je()(r,"0.value")||""};g({type:Z,initial:e})}}),[m,a,n,r]),Object(l.useEffect)((()=>{u(O)}),[O,u]),Object(l.useEffect)((()=>{const e=c&&0!==c.length;if(b&&e&&b!==c){const e=c[0];g({type:ee,changes:[["prodId",e.id],["prodValue",ke(e,v)],["prodPrice",e.price]]})}}),[v,b,c]);const E=Object(l.useCallback)((e=>{var t,a;const l=(null==e||null===(t=e.target)||void 0===t?void 0:t.value)||"",o=l?l.toString():"",n=(null==e||null===(a=e.target)||void 0===a?void 0:a.name)||"";g({type:ee,changes:[[n,o]]})}),[]),P=Object(l.useCallback)((e=>_(e)),[]),w=Object(l.useCallback)((e=>{g({type:ee,changes:e})}),[]),I=Object(l.useCallback)((()=>{p(O,s,(e=>{g({type:te,errors:e})}))}),[O,s,p]),C=Object(l.useCallback)((()=>{g({type:ae})}),[]),D=Object(l.useMemo)((()=>{let e=!0,t=[];return 0!==r.length?(e=!1,t=r.map((e=>{const t=[["opId",e.key],["opValue",e.value]];return{key:e.id,value:e.value,onClick:()=>w(t),props:{className:he,"data-testid":e.value}}}))):(e=!0,t.push({key:1,value:"",props:{className:he}})),{disabled:e,items:t}}),[r,w]),S=Object(l.useMemo)((()=>{let e=!0,t=[];return 0!==c.length?(e=!1,t=c.map((e=>{const t=ke(e,v),a=[["prodId",e.id],["prodValue",ke(e,v)]];return{key:e.id,value:t,onClick:()=>w(a),props:{className:Object(V.cx)(he,{disabled:3===e.status}),"data-testid":e.value}}}))):(e=!0,t.push({key:1,value:"",props:{className:he}})),{disabled:e,items:t}}),[v,c,w]);return o.a.createElement("div",{className:pe},o.a.createElement("div",{className:Object(V.cx)(me,"select")},o.a.createElement("label",{className:be,title:v.productType},v.productType),o.a.createElement(R.default,Object.assign({placeholder:v.productTypePlaceholder,value:N},D,{props:{className:ve}}))),o.a.createElement("div",{className:me},o.a.createElement("label",{className:be,title:v.clientNumber},v.clientNumber),o.a.createElement(z.a,{placeholder:v.textfieldPlaceholder,className:fe,name:"clientNumber",type:"number",min:"0",max:"9",value:y,onChange:E,onKeyPress:P}),Boolean(x.clientNumber)&&o.a.createElement(q,{onClose:C},(null==x?void 0:x.clientNumber)||"")),d&&o.a.createElement("div",{className:Object(V.cx)(me,"select")},o.a.createElement("label",{className:be,title:v.nominal},v.nominal),o.a.createElement(R.default,Object.assign({placeholder:v.nominalPlaceholder,value:j},S,{props:{className:Object(V.cx)(ve,{loading:t})}}))),o.a.createElement("div",{className:Object(V.cx)(me,"cta")},o.a.createElement(A.default,{main:!0,filled:!0,className:ge,disabled:!k,onClick:I},v.buyBtn)))};Ee.defaultProps={loading:!1,operator:{id:""},isShowingProduct:!0,operators:[],products:[],validations:[]};var Pe=Ee;const we={id:"",imageUrl:"",name:"",isValid:!1},Ie=e=>{const{menuID:t,type:a,validations:n,operators:r,slug:f,categoryID:v,onRenderComplete:h}=e,[g,y]=Object(l.useState)(we),{showToaster:N}=Object(l.useContext)(p.b),{isAuth:j}=Object(l.useContext)(b.a),{data:{user:x}}=Object(m.a)(),k=Object(i.a)({platformID:u.b,menuID:t,operatorID:g.id}),[E,P]=Object(s.useLazyQuery)(c.d,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0,ssr:!1}),w=Object(l.useMemo)((()=>c.f.productInput(P)),[P]),{id:C,isValid:D}=g,_=Object(l.useCallback)((e=>{let t;if("Telco"===a){const{clientNumber:a}=e;t=r.find((e=>a.startsWith(e.value)))}else{const{opId:a}=e;t=r.find((e=>e.key===a))}var l,o,n;t?y({id:(null===(l=t)||void 0===l?void 0:l.key)||"",name:(null===(o=t)||void 0===o?void 0:o.name)||"",imageUrl:(null===(n=t)||void 0===n?void 0:n.imageUrl)||"",isValid:!0}):y(we)}),[a,r,y]),V=Object(l.useCallback)((async(e,t,a)=>{const l=[];if(t.forEach((t=>{const{fieldName:a,rules:o}=t,n=e[a];let r;for(let e=0;e<o.length;e++){if(!new RegExp(o[e].rule).test(n)){r=o[e].message;break}}r&&l.push([a,r])})),l.length>0)a(l);else{const{prodId:t,prodValue:a,prodPrice:l}=e;Object(S.a)({operatorName:g.name,categoryID:v,slug:f,prodId:t,prodValue:a,prodPrice:l});const o=await(async e=>{const{fields:{clientNumber:t,prodId:a},operatorID:l,slug:o}=e,n={action:"init_data",client_number_enc:await I(t),instant_checkout:!1,operator_id:l,product_id:a,slug:o,enc_method:"rsa"};return O.a.stringify(n)})({fields:e,operatorID:g.id,slug:f}),n=`${d.R}?${o}`,r=j&&!1===(null==x?void 0:x.phoneVerified),i=!j||r;if(i){const e="Harap verifikasi nomor HP-mu sebelum melakukan transaksi ini.",t="Harap masuk dan verifikasi nomor HP-mu sebelum melakukan transaksi ini.",a={text:r?e:t,btnText:"",btnAction:()=>{},error:!0,time:3500};N(...Object.values(a))}(e=>{const t=null!=e?e:1e3;return new Promise((e=>setTimeout(e,t)))})(i?3e3:0).then((()=>{window.location.assign(n)}))}}),[g,f,v,N,j,x]),T=Object(l.useMemo)((()=>{const{data:{products:e,enquiries:t,...a},status:l,called:o}=w,n=D&&o&&"success"===l;return{loading:o&&"loading"===l,products:n&&e.length>0?e:[],enquiries:n&&t.validations?t:{validations:[]},...a}}),[D,w]),{loading:z,products:R,enquiries:A,isShowingProduct:B,isShowingEnquiry:L}=T,M=Object(l.useMemo)((()=>{const{validations:e}=A;return n.concat(e)}),[n,A]);return Object(l.useEffect)((()=>{k&&k.menuID!==t?y(we):k&&C&&C!==k.operatorID&&E({variables:{platformID:u.b,operatorID:C,menuID:t}})}),[k,t,C,E,y]),Object(l.useEffect)((()=>{h()}),[h]),"Telco"===a?o.a.createElement(ye,{loading:z,menuID:t,products:R,operator:g,validations:M,onOperatorChange:_,onSubmit:V}):o.a.createElement(Pe,{loading:z,menuID:t,products:R,operator:g,operators:r,validations:M,isShowingProduct:B,isShowingEnquiry:L,onOperatorChange:_,onSubmit:V})};Ie.defaultProps={categoryID:"",operators:[],validations:[],slug:"",onRenderComplete:r.a};t.default=Ie}}]);